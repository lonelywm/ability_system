[![tag](https://img.shields.io/github/v/tag/lonelywm/ability_system)](https://github.com/lonelywm/ability_system/tags) [![license](https://img.shields.io/github/license/lonelywm/ability_system)](LICENSE) [![compiler explorer](https://img.shields.io/badge/compiler_explorer-online-blue)](
    https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAM1QDsCBlZAQwBtMQBGAFlICsupVs1qhkAUgBMAISnTSAZ0ztkBPHUqZa6AMKpWAVwC2tEAFYADKS3oAMnlqYAcsYBGmYiADMPUgAdUBUJ1Wj1DE3MrAKC1OntHFyN3Tx9eJRVY2gYCZmICMONTS0VlTFUQ7NyCeOc3D29fBRy8gojipqqaxOSG7gBKRVQDYmQOAHJxCwBBKS8HZEMsAGpxLx1kJuIHYFXsSZnJOdoFg2XVnQIDP3Zd/dn5xcwVtYIATz9MAH0CYmZCBVu032AHpgUsAI4GVAEJ77GFGa7MGHPC6YBHCZHnN4fWjMIyYAB0RN2SwWzAUCiWOlYAK8e2mmwMqghUMxAHZZNMltylvDEZiXu8tHjCUSllNiMBafSpjylgYgqIlsw/NdXs8ACJUmnnCVSokE25eTkzNka1YmvkY2EvNH8m06JroEAgIIALy%2BBANJLJFO10v2jOZkOhX3dmAIKw5%2BzlVqRDqdLvD3wN4slAa5PIV22VqtY6tWWuptJ0eoU3rpFruZqrQOmoKWrDwTRW0zjAouQtx%2BNTZcBUyDkexymbkfE0cz3I6amQpLoTUwAA8/MQlonXXgPd815ubVrw6gqAaIGW%2BrXTebjXc23brSj18mvWK%2B5WGT8mZHwwQmy3xya5dOeCzmgtALsuq4Pru27hpqO4eoex6nue46XiacK3vGWIYTC5y%2BuWxJ0qSwh%2BgAKqQRHkvhBJplK/bDj%2BBC6umFbYEs6CoJ85LfEKDEQPRo7nCRTH6gRex0meV51lM7aYLhxGUkJr5TNmSpcfxv5eFqWALMOEDsZxCjcR8vHqYxayKdgEB9NZyH1mCKpquh6Lxiiw7dk8ABi5FuSKSwkbY/aDrmjmSTMN7OR2Pn4ksXm8l2Iq9umgXvsyDn5ucsWmcJVFGqxf4xlmirAHFHywVFnkujJwXpWsZYschNahU59qufF0WZW1Tz%2Bf2KnFWlrzboWJXCtF/UZeR3V0pVQq2WFUwNg4WCLp8ADuuSqh4zXWnJlF%2BeRkFbpGACS2hLslxAfksi1Lqt60fKu%2BWTvKRXDbBin/jygHAfOMLgWuBDOhuh1Xadi6wSdS0Nah17SdhslrHhqYkQo%2B0A0mUFPtRR0ZtJPECWs13LWtxAbcQgko0s2O7CxbEca4Bh4Kw6CfItQGYAofF4005MsajgOE58SiQlooznNjLESWh4X2jtpEBUpvVLPTjPM6zoyUkN2msLp%2BnK0zLPaGzHP%2BVZfMukYzAANZfALQsGCL8M6P56MersVk2U1dlLCuqB8GUjHS9tCPyTF52XT7fuqJ8xD6LCE6yjyMmy1RNE43Kiv9WVnUxZVcPVa8WLZ2WLoAEqx/VTWNVLsMRY7eGh0pQUR/7Rlxx93JJ8HlGJbRSnpy9mdDeVOcgFVY2CjivnF6PQoV2hVcw536whx5YfMs3UeE1G7e8nDheTz2z5JX3hU5oPmnDe5I9j3mBe1emLqE3P1bQ1JIJghbBDIAgAKB5hE8jSeAAWW8kXaQDBQEHy6rYSBgC/Il1ge5VMJd2ZmRlEFT%2B39aTVyXsPEBl8p7gMQb5fyxDookQQQQw%2B1EUHcwVi9TBP9BoX2Howks%2BCphEL8jA%2BB5FaGY12NND4s1cHZ3wcPThZDRTUU4RAqhXVWBSKRjw4eJEyDyKRpQ4eR0rAaLFEdJRYodCGOojoAxejTFTBMUsfha9IxsJROIrmZlSzyHFOA3mw0GKCUUdwzxWVzLqIof45xYtdFHRCcZfGOgdCRJHHQmJETRKwO8WsUsnj%2BE00egnbkithywTYd8c4TiokJNkXE1JTtfH%2BQqdE4JySvHRKSYaOkKTomxKJBNMmrTGkJLMQaciOjdhtL6VMAZ7jhk2NQc/IEC8/44QAVfEpcDJEWPcXI1R1jSFrIoVIymujyqpnMYcox1izFnKsWs2xjcUr2KRFgxxIyXGrPKQ0gJTsJq2FqQksi8DvkuJ0YM/55wOktOwE8kFzTJnvPSQ0zJolt4FVyS9fJQ1CkuOWZU15YKIXmU%2BcC8yJcCX9LeaEtJ4yLK4sSeMoZPSYVjM6RMnp8KwVQxEXvRZvlllIOfFw1RviTnUW2ao9RgreHyP2dY45nVUzGLWec%2BVlyxXXPQbcpYDjilUo4R40lpSXEkWqV83V8T9VBKJcaypgLKbEtBdCsl1KLXtIZTiqZTQsnx37jmVFF90Wat6S4u1eqfH4sdT881Lr3lQrpfa0FXTA0mshTSiw8bKmwoJORbVDAMnTNEmyz2NcZacuityhKvKNnZ1%2BWK4VMqxS7IlVasV0qoGyrOU2wBsqlU1poagux6r7k/0ef6v12KU11JDRG%2B1vz6kTqDWsK1UbwVDvJaGlxJKZ0JrSc6yZLKSTZM9Uqb1WpfVrExdE0dPzx3nv1eGq9YsbUUtvWk5pgzk3RtnTE51GbyIjuZTm1lldX5zVEVApYJbyECq7dwvZaitlaOzg2yDbaeWmNbRc6xKrAxqo1Seqlj6qmXrfRup2ZriXzvvSuxNFHN3ZrdQivdp8D1CgKf2wyGLcOEcqQagji73nTrwwuqlsa/LdJ4zG59%2By8Npu3X%2Bo089ANbX/p2EDYGupbJUZBut2iDmIbOahxV6Ge03IusybDOhT0JLw1Oo167OMTRvRxpp4TyM2faQJpdH6aMCMIvR5FXqmNopY0UnD7mpMOZ%2BdZyTFK7M2vE2RqjOg8OJd/bR9NEnKwAfZbXfecCVPKN0/KpDpbLEGboaq4zdyv4Dr9e8yzEWwsBvq%2BcSL8W12Sa3clrzeUPUMeKoevtlXWPVftbV5zkm3M1ca2sNrnmZkXky4WpTOXrGyNg1K/LYqFUbc7c2sUGG3zlf61gob76f2iffZZ%2BzZ2iPjZjTFm17XF07u8913zjHSpD3tU9sScn5t3nOAdT0Swjk4xAmBFcyoDBEBBktBgmBhbHEwCggAbh4JQEB1y2zh/bBHYscqEVB4xSQAA2M80wAC0JIta6Qx6DQWWOHb/d3AhIkEBsZ9CWGTpYnAACqHPKZ472NGM0ktF553%2B2jIGgOnA9QYVbTAEMlyw/h6MZHqPZJAgvlToUEBCZK%2BxyrzAKPiBo/XBba2Bslp0%2BV47aXlYhcag9tXBTkVs5wZ29RS8ZXLpTFcIzQgBYXvPRzGXdgsES7nn3cVDUmAcToAUPYDSWp3kalm3KJHqA8DoGVAoE6hAIAGnZ/lGsT1mCQ9QNnk66frb56JIXjkSxiARmGLQDnnALRRnNLM%2BT8yHRip937tQ7N%2Bz13702N4eh6B/EcA9QPitR/BAUCRK4oehrrkuNcR28/B8C4jzyLfzYl8b6WJxX3Y%2B8BD/zX4AwrgmzIBAEi8Up//cT5yA4DwVlEVPUj5TQ26tmPWwV0XD1wdlV2N0dgPCPBZ333Zgkm%2BwfzlFYFQFQD8ANjzxPwH3PwpghiNndl325BQgf2AzgXDxPm5FLyICkCJ0oKWCoEWg/x8zlCDyVGwL/1XwlzNxtlpztgZzWAgMQif231gLwMYPINQEoOoMYUwCzyGhYFYFYBZnRHOBIMsnXBoGIGJnQF1AEIP2X3hksnQLPxgMGV/3ZlwNCkYJ5Eb0uGIBb0kM0PMJ5AIKeiIKvmUIf1EPEOJwb1oO0HoPryWAbFAKUBoMWngJ6x/3wFYJ9Tl0AOAIRyCPAKZ0gIJBPG0JgNkzCLILL08KJ0OwQCkNglkPkLwEULWGUPRwlzUI0K0IwMX10LdgMOCCMIiJwMd0yIbybxsLyKkOEKcJyV3iyyLSeDd3bTFAAAVcg8Q04eRRCQYq9MAIAJjfgjAARidKDUw/BJiVi68d5v8WD2ZYJTc5cLcbpuCcdeCkj%2BCMD0j0tdiZjsi1ivC7DCi2BijSidByjVCSBqjaptC6iN8GjmA0iFABgWj1YzC7juQrDm9aZPgiiIA7DyJNjliqIRcno%2Bj9gVw8Akd4x78np09M8QZCBPg6AFidi%2BjYwOVFsr5ttRiZFZBSClgCSs8HBiTSSTwcjlRv1ZBHiidUwgSQTP9%2Bjv8GJvhy8PsQN1xtJmABpnlBEQBo9Y9498ZISmDioGJYI1J7V99/ibhbj2jFZRSVpCAEATjFwDiho9ZVYTCSxUk4Cv9wiGJJAY4V8L5%2BogsdAN4CBo5Y5zgQwFlFs7TJkgyHCLDFY7CSiVRmMBsPT2iAIJdpTZTdRhk4yeQGJSBUzuRRSiAMyHSLCnSXTMBczhSLDGxRxVoTSzT2ZizSzGCJtwVMz3MUy8y6zht0t7SSzXtio1YLS3Tb4PSvSzS/TWQwxdwXEadLczjRZ2zyIIyLY/AMiWz9JWSCAIBmByJGjt9yIeyOY2iWyVySTHA1zXBUTeji9%2BiXCSFdCzZJcUx9F%2Bw5RZjEDkDUDVzD8bheTeQbzMdrc71RJySWzoSuiDz2T1xgAIwxY3Yvj1Dch7CnZ6i6Q%2BJrIC8zzO85pKTBjqSuVoNrz/pAZHwjkHz7iodlzaA88gFOSjAJp6jPyCBvyuD6dzjWtxIhTaygLbCCRyRc9VywKIK50oLKjvjYLBIELLICBkLa9UKYYMKFs8FrElipiiKsiSKOJ4SKLPyqKlgFKViciNitjBSGC5R2L1VOKc9aB5iIBkSpiULQyO9pLE4qTh4Rir53yiy8KXZPRCLGSPDPyiiFDrgIBXLOS6L3KQAfz9dHYF0ALOyOjrCW8/KSjrglCBLAZwKAUUqXQqjhLzJRKkK%2BgbKd4KSHLa5WoQNnLfIPI8BjcQqxVbBMAqA0F3CHiqCvCEr0QIBKrqrOTaDqryI6qGrdKxR2AGroray8AqA5xQJfpwcKj%2BZDIFARRssr4pSygZSMoqrSshEOAQAQ83LlCXQcTDBMBRrazLDOiW8eq6FVSiqLDlBgjDLSzjK2qkqyi3ZhrMY0SYqbq7LnCxchibE9lbByRGqS9mrqDnrWAIAgbuZPziJxLWLHrzrGxgapKu9Zp7hjhHgUR1BNhMA8R%2BwMaTgzheCfhtgCbDgHhTgHR5zyajgiaHQUdVASBabKbiadB1ALYyKFylJMMDtuclAZ8d4HxSalRM9hDhatglR3JxaJdNgcwlBFxhCHBIxmBwK80ndph3IFBNjRhs9BaH8goSJCA9Sha1UNRmxEQ75TaDtYcMgZaDsNQkRmB7bLoABpTAV4bBF%2BGGIKKYI278eGE0X2827W4QK23m73W2/2c8YOp2mOtVKYd2z22aX2/29gEAb2a/W/R/AfO%2BHQckTwEANOvQhGqcCXRmogbpR0WWkWnYQiLi8y1AavE6iw4y9cCu5mkm/C2u3daMSQSQI6TQ/u8iKQSQJwRa4elYfu2HRWye0eqYNW/ugg2yjEuZOaX2qO1QDOq/G/ICHOsfPOgul0TekKo%2BhUuO57U2wGGmrupMWu8iVwJA1gEkdIf2Ho2yqYR2nIAAKm9i/udtsuZIrzItXM/rjq8P/p2L/qdtgkoP/vb2%2Bsfv0GAYsolpzEzxbsYPGqWAgDADAFftUCkIJDQAMHoB13QGslLtOoIZhE0LMGkDFrMC1CHgukDsbOMvfDYZbO%2BoAlKEIfQAJA8HJAWIweEKMqRqoDYCUFRrm3zVjpyG3qzr3q30PoUELvgcvoNvYJVHF27sluAHIn5s2kIgVA8CAR0Y/v/r8NVNMeIHMYXPodHosDbyXqYdgiMbJj7skGcdHpHv7pIlQCMF8anskCCcns4AAA5l6bGBb7HxBHH%2B6LBJBR74nmGL4PH8pEnkm57%2B7bAmQC4cnJAqBgnOA2RomH9V7u8BwE6Q7LbFHd7ZwVHzgz7amw7yIWmL6usd4wGf7oGchhCgGG688ennaIGnaoG/B/7YHicNHpAfr%2Bj27/ZO7q69Gyb66zLUGa79GroKGqG5QMmvDbHYJJmnaKc6RbG4n6HGHANazFmmaq60HRASRUlVSGICQr8FBTTXBmBkBLYIBbGCRRHbKEDRx3mFQvmfm/mAX3JPray3mPmIXfn/mBaCQFbYXSz4XwXPhvmkW18OI5bRBkWPBOLwK9yYrjKXmKnzzympJfak6FB6ns6mm1gz76X2m1GXQNGumH8Rnf6Tn%2BnAGM8s8hnQH4GxmcgJmpmho4GL65nvq7nK7dG779GSQG6LLMH4zAYO6Hmtm1nWJrZk7gWeQ1CcHZjCA0Rt7/6znsALmVQNXSyDXywEXsXIWdd4QCRLrxKxHHDzy2KkbHWZGaW5p64SIgT07M6Gn97n86BX9p9dQT7v1WmZTv02XxR/7v1i7e7ZA179hla%2B0HBrGH9Q2b8ngcgS3hCTW1yy82InaM6y32BAXG7rZmmOWi7ja9D3Y9nPoJcSGxwps1hQqlACAVoIAInC9%2B2dAa2cgURzgQmQmZHNWXRe2Z2B31wbBn7805RK3ZiDW62w3CQHB5iW3C76W3ZKGHruRt3q30Ba3eR93G2j2WXW2k275LIDXz3A9bme2hg%2B2EtV3ZaIwR2x2V3J2b3p2msB3R752jX8DfXSz1xl2IPJ213tAN3CrqWzQxgBhWAQAxgzAxhSBTAxgLACPUBcOEsZA5A1whgRhYRDhOACOCBcOSPrJSBLYQBuALACQknOALAImABOLwCJyQTgInITzgMwIQXD7gAjojkj0gMjsYAjhlqwJj4jrD0gOAWAJANABERmDwcgSgXTvwfTzwYAXjyQUgWg7WVHSgVwZjgj33XEYgV4XDhj0gXT/EegAAeVoHzAc9ICwE5uAHTvU8C6qv9mxPZgC6XDKEh3GHk%2BVuUAC6bFcF%2BBc70CwDc8Y62CMGy4GBoHoCYDYA4F8AEE4CEBEDEDkDkCEDwBPPgAGGQMyAZbGDJzJydELAkEo5kFKeU74cyE0G0FaFMAq5sC6DqE8Aq%2BiGCDoBG8EBm8yAm6SHqAq5oYqGaHyH0EKEEHW7oEqDyGW56DW82/m5O86Df26FW4GAUBo9GC4Gw9w/w8I4C8U8XAiaJzJyJ24CWGAGQFnF44JEkBwdwEIBICnp8HIj0D0/YAeno/Zwo55OkEY4c9Y/yOYCwE8FNnY8kH46B7E4sAsC8C8G4DZAiYk4sDZEs5w7GBk5e7C8U%2BU5AFU9R805gEQBAB/avzoooAgGM9M8ECkLB6m6s5jeK/Tt8BWl%2BD8FZ5p%2Be7k9I9w9mE4CWGNIIAQCWHe8%2B%2B%2B9%2B/%2B65y48kBR/U9Y/Y68C47ZAk/48p8kDZEJ5E84Bt6k9p9k9e9w6Z5Z%2BN8e7GEN/p/k8Z9IDU5Y4GCNyCA0G4CAA%3D%3D%3D
) 

## Ability System
面向对象编程虽然强大但也有一些缺点，本质上而言，面向对象编程将数据和方法强关联在了一起，程序员不得不面对一个非常臃肿的Class，Class中某些数据和方法是关联的，但并非所有的数据与所有的方法都一一关联，这就带来了冗余；而且在逻辑上，一个类往往拥有很多种能力，这导致可读性和复用性下降。

本框架设计的初衷就是为了将臃肿的`大类`拆分成若干个`小类`（结构体），用若干单一功能的`小类`组成一个复杂的`大类`，就像搭积木一样。这样可以增加代码的可读性，降低维护成本，拆分出的小类都是单一职责的，容易理解而且可以随意组合。由于采用了组件设计模式，一个类的能力取决于它有什么样的组件，这样做的好处是比继承更加灵活且高效（虚函数会增加开销），而且借助于C++ Template，组件是静态的，即在编译期实现的，不会产生额外的运行时开销，

## Feature
1. Header-only, Powerful, Tiny
2. Ioc: Inversion of Control
3. Static Component Pattern using C++ template
4. Single Responsibility Principle
5. Self-explanatory and Easy to read

## Basic
本系统主要包含两个模板类：`Ability`、`AbilityContainer`和一个`角色`的概念
```
// Ability System Role
namespace asr {
    struct A;
    struct B;
    struct C;
}
class A: public Ability<asr::A> {};
class B: public Ability<asr::B, asr::A, asr::C> {};
class C: public Ability<asr::C, asr::A> {};
class ABC: public AbilityContainer<A, B, C> {};
```
- `AbilityContainer`类是`变长模板`的`大类`，由若干`小类`组成，可以接任意个数的小类。
- `角色`是`小类`的模板参数，可以理解成对于某个功能的命名和抽象，大部分情况下角色就是一个类型声明。
- `Ability`类是`变长模板`的`小类`，各个`小类`之间有依赖关系，依赖关系由其后面的模板参数决定，第一个表示自己的角色，剩余的表示其依赖的角色，所有至少要一个模板（必须标定自己的角色，可以没有依赖）。
- `struct B: public Ability<asr::C, asr::A, asr::C>`的含义是：对于B类，它的角色是`B`，它的依赖是`A`和`C`。


## Quick Start
> run it online : [**compiler explorer**](
    https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAM1QDsCBlZAQwBtMQBGAFlICsupVs1qhkAUgBMAISnTSAZ0ztkBPHUqZa6AMKpWAVwC2tEAFYADKS3oAMnlqYAcsYBGmYiADMPUgAdUBUJ1Wj1DE3MrAKC1OntHFyN3Tx9eJRVY2gYCZmICMONTS0VlTFUQ7NyCeOc3D29fBRy8gojipqqaxOSG7gBKRVQDYmQOAHJxCwBBKS8HZEMsAGpxLx1kJuIHYFXsSZnJOdoFg2XVnQIDP3Zd/dn5xcwVtYIATz9MAH0CYmZCBVu032AHpgUsAI4GVAEJ77GFGa7MGHPC6YBHCZHnN4fWjMIyYAB0RN2SwWzAUCiWOlYAK8e2mmwMqghUMxAHZZNMltylvDEZiXu8tHjCUSllNiMBafSpjylgYgqIlsw/NdXs8ACJUmnnCVSokE25eTkzNka1YmvkY2EvNH8m06JroEAgIIALy%2BBANJLJFO10v2jOZkOhX3dmAIKw5%2BzlVqRDqdLvD3wN4slAa5PIV22VqtY6tWWuptJ0eoU3rpFruZqrQOmoKWrDwTRW0zjAouQtx%2BNTZcBUyDkexymbkfE0cz3I6amQpLoTUwAA8/MQlonXXgPd815ubVrw6gqAaIGW%2BrXTebjXc23brSj18mvWK%2B5WGT8mZHwwQmy3xya5dOeCzmgtALsuq4Pru27hpqO4eoex6nue46XiacK3vGWIYTC5y%2BuWxJ0qSwh%2BgAKqQRHkvhBJplK/bDj%2BBC6umFbYEs6CoJ85LfEKDEQPRo7nCRTH6gRex0meV51lM7aYLhxGUkJr5TNmSpcfxv5eFqWALMOEDsZxCjcR8vHqYxayKdgEB9NZyH1mCKpquh6Lxiiw7dk8ABi5FuSKSwkbY/aDrmjmSTMN7OR2Pn4ksXm8l2Iq9umgXvsyDn5ucsWmcJVFGqxf4xlmirAHFHywVFnkujJwXpWsZYschNahU59qufF0WZW1Tz%2Bf2KnFWlrzboWJXCtF/UZeR3V0pVQq2WFUwNg4WCLp8ADuuSqh4zXWnJlF%2BeRkFbpGACS2hLslxAfksi1Lqt60fKu%2BWTvKRXDbBin/jygHAfOMLgWuBDOhuh1Xadi6wSdS0Nah17SdhslrHhqYkQo%2B0A0mUFPtRR0ZtJPECWs13LWtxAbcQgko0s2O7CxbEca4Bh4Kw6CfItQGYAofF4005MsajgOE58SiQlooznNjLESWh4X2jtpEBUpvVLPTjPM6zoyUkN2msLp%2BnK0zLPaGzHP%2BVZfMukYzAANZfALQsGCL8M6P56MersVk2U1dlLCuqB8GUjHS9tCPyTF52XT7fuqJ8xD6LCE6yjyMmy1RNE43Kiv9WVnUxZVcPVa8WLZ2WLoAEqx/VTWNVLsMRY7eGh0pQUR/7Rlxx93JJ8HlGJbRSnpy9mdDeVOcgFVY2CjivnF6PQoV2hVcw536whx5YfMs3UeE1G7e8nDheTz2z5JX3hU5oPmnDe5I9j3mBe1emLqE3P1bQ1JIJghbBDIAgAKB5hE8jSeAAWW8kXaQDBQEHy6rYSBgC/Il1ge5VMJd2ZmRlEFT%2B39aTVyXsPEBl8p7gMQb5fyxDookQQQQw%2B1EUHcwVi9TBP9BoX2Howks%2BCphEL8jA%2BB5FaGY12NND4s1cHZ3wcPThZDRTUU4RAqhXVWBSKRjw4eJEyDyKRpQ4eR0rAaLFEdJRYodCGOojoAxejTFTBMUsfha9IxsJROIrmZlSzyHFOA3mw0GKCUUdwzxWVzLqIof45xYtdFHRCcZfGOgdCRJHHQmJETRKwO8WsUsnj%2BE00egnbkithywTYd8c4TiokJNkXE1JTtfH%2BQqdE4JySvHRKSYaOkKTomxKJBNMmrTGkJLMQaciOjdhtL6VMAZ7jhk2NQc/IEC8/44QAVfEpcDJEWPcXI1R1jSFrIoVIymujyqpnMYcox1izFnKsWs2xjcUr2KRFgxxIyXGrPKQ0gJTsJq2FqQksi8DvkuJ0YM/55wOktOwE8kFzTJnvPSQ0zJolt4FVyS9fJQ1CkuOWZU15YKIXmU%2BcC8yJcCX9LeaEtJ4yLK4sSeMoZPSYVjM6RMnp8KwVQxEXvRZvlllIOfFw1RviTnUW2ao9RgreHyP2dY45nVUzGLWec%2BVlyxXXPQbcpYDjilUo4R40lpSXEkWqV83V8T9VBKJcaypgLKbEtBdCsl1KLXtIZTiqZTQsnx37jmVFF90Wat6S4u1eqfH4sdT881Lr3lQrpfa0FXTA0mshTSiw8bKmwoJORbVDAMnTNEmyz2NcZacuityhKvKNnZ1%2BWK4VMqxS7IlVasV0qoGyrOU2wBsqlU1poagux6r7k/0ef6v12KU11JDRG%2B1vz6kTqDWsK1UbwVDvJaGlxJKZ0JrSc6yZLKSTZM9Uqb1WpfVrExdE0dPzx3nv1eGq9YsbUUtvWk5pgzk3RtnTE51GbyIjuZTm1lldX5zVEVApYJbyECq7dwvZaitlaOzg2yDbaeWmNbRc6xKrAxqo1Seqlj6qmXrfRup2ZriXzvvSuxNFHN3ZrdQivdp8D1CgKf2wyGLcOEcqQagji73nTrwwuqlsa/LdJ4zG59%2By8Npu3X%2Bo089ANbX/p2EDYGupbJUZBut2iDmIbOahxV6Ge03IusybDOhT0JLw1Oo167OMTRvRxpp4TyM2faQJpdH6aMCMIvR5FXqmNopY0UnD7mpMOZ%2BdZyTFK7M2vE2RqjOg8OJd/bR9NEnKwAfZbXfecCVPKN0/KpDpbLEGboaq4zdyv4Dr9e8yzEWwsBvq%2BcSL8W12Sa3clrzeUPUMeKoevtlXWPVftbV5zkm3M1ca2sNrnmZkXky4WpTOXrGyNg1K/LYqFUbc7c2sUGG3zlf61gob76f2iffZZ%2BzZ2iPjZjTFm17XF07u8913zjHSpD3tU9sScn5t3nOAdT0Swjk4xAmBFcyoDBEBBktBgmBhbHEwCggAbh4JQEB1y2zh/bBHYscqEVB4xSQAA2M80wAC0JIta6Qx6DQWWOHb/d3AhIkEBsZ9CWGTpYnAACqHPKZ472NGM0ktF553%2B2jIGgOnA9QYVbTAEMlyw/h6MZHqPZJAgvlToUEBCZK%2BxyrzAKPiBo/XBba2Bslp0%2BV47aXlYhcag9tXBTkVs5wZ29RS8ZXLpTFcIzQgBYXvPRzGXdgsES7nn3cVDUmAcToAUPYDSWp3kalm3KJHqA8DoGVAoE6hAIAGnZ/lGsT1mCQ9QNnk66frb56JIXjkSxiARmGLQDnnALRRnNLM%2BT8yHRip937tQ7N%2Bz13702N4eh6B/EcA9QPitR/BAUCRK4oehrrkuNcR28/B8C4jzyLfzYl8b6WJxX3Y%2B8BD/zX4AwrgmzIBAEi8Up//cT5yA4DwVlEVPUj5TQ26tmPWwV0XD1wdlV2N0dgPCPBZ333Zgkm%2BwfzlFYFQFQD8ANjzxPwH3PwpghiNndl325BQgf2AzgXDxPm5FLyICkCJ0oKWCoEWg/x8zlCDyVGwL/1XwlzNxtlpztgZzWAgMQif231gLwMYPINQEoOoMYUwCzyGhYFYFYBZnRHOBIMsnXBoGIGJnQF1AEIP2X3hksnQLPxgMGV/3ZlwNCkYJ5Eb0uGIBb0kM0PMJ5AIKeiIKvmUIf1EPEOJwb1oO0HoPryWAbFAKUBoMWngJ6x/3wFYJ9Tl0AOAIRyCPAKZ0gIJBPG0JgNkzCLILL08KJ0OwQCkNglkPkLwEULWGUPRwlzUI0K0IwMX10LdgMOCCMIiJwMd0yIbybxsLyKkOEKcJyV3iyyLSeDd3bTFAAAVcg8Q04eRRCQYq9MAIAJjfgjAARidKDUw/BJiVi68d5v8WD2ZYJTc5cLcbpuCcdeCkj%2BCMD0j0tdiZjsi1ivC7DCi2BijSidByjVCSBqjaptC6iN8GjmA0iFABgWj1YzC7juQrDm9aZPgiiIA7DyJNjliqIRcno%2Bj9gVw8Akd4x78np09M8QZCBPg6AFidi%2BjYwOVFsr5ttRiZFZBSClgCSs8HBiTSSTwcjlRv1ZBHiidUwgSQTP9%2Bjv8GJvhy8PsQN1xtJmABpnlBEQBo9Y9498ZISmDioGJYI1J7V99/ibhbj2jFZRSVpCAEATjFwDiho9ZVYTCSxUk4Cv9wiGJJAY4V8L5%2BogsdAN4CBo5Y5zgQwFlFs7TJkgyHCLDFY7CSiVRmMBsPT2iAIJdpTZTdRhk4yeQGJSBUzuRRSiAMyHSLCnSXTMBczhSLDGxRxVoTSzT2ZizSzGCJtwVMz3MUy8y6zht0t7SSzXtio1YLS3Tb4PSvSzS/TWQwxdwXEadLczjRZ2zyIIyLY/AMiWz9JWSCAIBmByJGjt9yIeyOY2iWyVySTHA1zXBUTeji9%2BiXCSFdCzZJcUx9F%2Bw5RZjEDkDUDVzD8bheTeQbzMdrc71RJySWzoSuiDz2T1xgAIwxY3Yvj1Dch7CnZ6i6Q%2BJrIC8zzO85pKTBjqSuVoNrz/pAZHwjkHz7iodlzaA88gFOSjAJp6jPyCBvyuD6dzjWtxIhTaygLbCCRyRc9VywKIK50oLKjvjYLBIELLICBkLa9UKYYMKFs8FrElipiiKsiSKOJ4SKLPyqKlgFKViciNitjBSGC5R2L1VOKc9aB5iIBkSpiULQyO9pLE4qTh4Rir53yiy8KXZPRCLGSPDPyiiFDrgIBXLOS6L3KQAfz9dHYF0ALOyOjrCW8/KSjrglCBLAZwKAUUqXQqjhLzJRKkK%2BgbKd4KSHLa5WoQNnLfIPI8BjcQqxVbBMAqA0F3CHiqCvCEr0QIBKrqrOTaDqryI6qGrdKxR2AGroray8AqA5xQJfpwcKj%2BZDIFARRssr4pSygZSMoqrSshEOAQAQ83LlCXQcTDBMBRrazLDOiW8eq6FVSiqLDlBgjDLSzjK2qkqyi3ZhrMY0SYqbq7LnCxchibE9lbByRGqS9mrqDnrWAIAgbuZPziJxLWLHrzrGxgapKu9Zp7hjhHgUR1BNhMA8R%2BwMaTgzheCfhtgCbDgHhTgHR5zyajgiaHQUdVASBabKbiadB1ALYyKFylJMMDtuclAZ8d4HxSalRM9hDhatglR3JxaJdNgcwlBFxhCHBIxmBwK80ndph3IFBNjRhs9BaH8goSJCA9Sha1UNRmxEQ75TaDtYcMgZaDsNQkRmB7bLoABpTAV4bBF%2BGGIKKYI278eGE0X2827W4QK23m73W2/2c8YOp2mOtVKYd2z22aX2/29gEAb2a/W/R/AfO%2BHQckTwEANOvQhGqcCXRmogbpR0WWkWnYQiLi8y1AavE6iw4y9cCu5mkm/C2u3daMSQSQI6TQ/u8iKQSQJwRa4elYfu2HRWye0eqYNW/ugg2yjEuZOaX2qO1QDOq/G/ICHOsfPOgul0TekKo%2BhUuO57U2wGGmrupMWu8iVwJA1gEkdIf2Ho2yqYR2nIAAKm9i/udtsuZIrzItXM/rjq8P/p2L/qdtgkoP/vb2%2Bsfv0GAYsolpzEzxbsYPGqWAgDADAFftUCkIJDQAMHoB13QGslLtOoIZhE0LMGkDFrMC1CHgukDsbOMvfDYZbO%2BoAlKEIfQAJA8HJAWIweEKMqRqoDYCUFRrm3zVjpyG3qzr3q30PoUELvgcvoNvYJVHF27sluAHIn5s2kIgVA8CAR0Y/v/r8NVNMeIHMYXPodHosDbyXqYdgiMbJj7skGcdHpHv7pIlQCMF8anskCCcns4AAA5l6bGBb7HxBHH%2B6LBJBR74nmGL4PH8pEnkm57%2B7bAmQC4cnJAqBgnOA2RomH9V7u8BwE6Q7LbFHd7ZwVHzgz7amw7yIWmL6usd4wGf7oGchhCgGG688ennaIGnaoG/B/7YHicNHpAfr%2Bj27/ZO7q69Gyb66zLUGa79GroKGqG5QMmvDbHYJJmnaKc6RbG4n6HGHANazFmmaq60HRASRUlVSGICQr8FBTTXBmBkBLYIBbGCRRHbKEDRx3mFQvmfm/mAX3JPray3mPmIXfn/mBaCQFbYXSz4XwXPhvmkW18OI5bRBkWPBOLwK9yYrjKXmKnzzympJfak6FB6ns6mm1gz76X2m1GXQNGumH8Rnf6Tn%2BnAGM8s8hnQH4GxmcgJmpmho4GL65nvq7nK7dG779GSQG6LLMH4zAYO6Hmtm1nWJrZk7gWeQ1CcHZjCA0Rt7/6znsALmVQNXSyDXywEXsXIWdd4QCRLrxKxHHDzy2KkbHWZGaW5p64SIgT07M6Gn97n86BX9p9dQT7v1WmZTv02XxR/7v1i7e7ZA179hla%2B0HBrGH9Q2b8ngcgS3hCTW1yy82InaM6y32BAXG7rZmmOWi7ja9D3Y9nPoJcSGxwps1hQqlACAVoIAInC9%2B2dAa2cgURzgQmQmZHNWXRe2Z2B31wbBn7805RK3ZiDW62w3CQHB5iW3C76W3ZKGHruRt3q30Ba3eR93G2j2WXW2k275LIDXz3A9bme2hg%2B2EtV3ZaIwR2x2V3J2b3p2msB3R752jX8DfXSz1xl2IPJ213tAN3CrqWzQxgBhWAQAxgzAxhSBTAxgLACPUBcOEsZA5A1whgRhYRDhOACOCBcOSPrJSBLYQBuALACQknOALAImABOLwCJyQTgInITzgMwIQXD7gAjojkj0gMjsYAjhlqwJj4jrD0gOAWAJANABERmDwcgSgXTvwfTzwYAXjyQUgWg7WVHSgVwZjgj33XEYgV4XDhj0gXT/EegAAeVoHzAc9ICwE5uAHTvU8C6qv9mxPZgC6XDKEh3GHk%2BVuUAC6bFcF%2BBc70CwDc8Y62CMGy4GBoHoCYDYA4F8AEE4CEBEDEDkDkCEDwBPPgAGGQMyAZbGDJzJydELAkEo5kFKeU74cyE0G0FaFMAq5sC6DqE8Aq%2BiGCDoBG8EBm8yAm6SHqAq5oYqGaHyH0EKEEHW7oEqDyGW56DW82/m5O86Df26FW4GAUBo9GC4Gw9w/w8I4C8U8XAiaJzJyJ24CWGAGQFnF44JEkBwdwEIBICnp8HIj0D0/YAeno/Zwo55OkEY4c9Y/yOYCwE8FNnY8kH46B7E4sAsC8C8G4DZAiYk4sDZEs5w7GBk5e7C8U%2BU5AFU9R805gEQBAB/avzoooAgGM9M8ECkLB6m6s5jeK/Tt8BWl%2BD8FZ5p%2Be7k9I9w9mE4CWGNIIAQCWHe8%2B%2B%2B9%2B/%2B65y48kBR/U9Y/Y68C47ZAk/48p8kDZEJ5E84Bt6k9p9k9e9w6Z5Z%2BN8e7GEN/p/k8Z9IDU5Y4GCNyCA0G4CAA%3D%3D%3D
)  

假设我们现在要设计一个数据库中的员工信息表
我们需要完成三个功能：
- 描述表头
- 描述表格内容
- 记录表格的选中状态

```
#include <vector>
#include <string>
#include <map>

struct User {
    std::string id;
    std::string name;
    std::string sex;
    int age;
};

class Table {
public:
    std::vector<std::string> titles()                { ... }
    std::vector<std::string> keys()                  { ... }
    std::vector<std::string> display(std::string id) { ... }
    bool                     select(std::string id)  { ... }
private:
    ...
};
```
正常情况下，我们可以设计出类似上述代码的接口。


```
#include <vector>
#include <string>
#include <map>
#include <iostream>
#include <iomanip>

struct User {
    std::string id;
    std::string name;
    std::string sex;
    int age;
};

namespace asr {
    struct Title;
    struct Display;
    struct Select;
    struct Data;
    struct Keys;
}

struct ATitle;
struct ADisplay;
struct ASelect;
struct AData;
struct AKeys;

struct ATitle: public Ability<asr::Title> {
    std::vector<std::string> asInvoke() {
        return std::vector<std::string> {"Id", "Name", "Sex", "Age"};
    }
};

struct AData: public Ability<asr::Data> {
    std::map<std::string, User> userMap;
    AData() {
        userMap["01"] = User{"01", "Tom", "m", 18};
        userMap["02"] = User{"02", "Lucy", "f", 17};
    }
};

struct ASelect: public Ability<asr::Select, asr::Data> {
    std::map<std::string, bool> selected;
    AData* pData;
    void asInit(AData& Data) { pData = &Data; }
    bool asInvoke(std::string id) {
        if (!selected.count(id)) {
            selected[id] = true;
            return true;
        }
        selected.erase(id);
        return false;
    }
};

struct ADisplay: public Ability<asr::Display, asr::Data> {
    AData* pData;
    void asInit(AData& Data) { pData = &Data; }
    std::vector<std::string> asInvoke(std::string id) {
        User& user = pData->userMap[id];
        std::vector<std::string> list;
        list.push_back(user.id);
        list.push_back(user.name);
        list.push_back(user.sex);
        list.push_back(std::to_string(user.age));
        return list;
    }
};

struct AKeys: public Ability<asr::Keys, asr::Data> {
    AData* pData;
    void asInit(AData& Data) { pData = &Data; }
    std::vector<std::string> asInvoke() {
        std::vector<std::string> keys;
        for (auto item: pData->userMap) {
            keys.push_back(item.first);
        }
        return keys;
    }
};

class Table: public AbilityContainer<ASelect, ADisplay, AKeys, AData, ATitle> {
public:
    std::vector<std::string> titles()                { return invoke<asr::Title>(); }
    std::vector<std::string> keys()                  { return invoke<asr::Keys>(); }
    std::vector<std::string> display(std::string id) { return invoke<asr::Display>(id); }
    bool                     select(std::string id)  { return invoke<asr::Select>(id); }
};

int main() {
    Table table;
    for (auto data: table.invoke<asr::Title>()) {
        std::cout << std::setw(8) << data << " ";
    }
    std::cout << std::endl;

    for (auto key: table.keys()) {
        for (auto data: table.invoke<asr::Display>(key)) {
            std::cout << std::setw(8) << data << " ";
        }
        std::cout << std::endl;
    }
}

```

输出：
```
Id     Name      Sex      Age 
01      Tom        m       18 
02     Lucy        f       17 
```

我们的代码还可以进一步简化
```
class Table: public AbilityContainer<ASelect, ADisplay, AKeys, AData, ATitle> {};

int main() {
    Table table;
    for (auto data: table.invoke<asr::Title>()) {
        std::cout << std::setw(8) << data << " ";
    }
    std::cout << std::endl;

    for (auto key: table.keys()) {
        for (auto data: table.invoke<asr::Display>(key)) {
            std::cout << std::setw(8) << data << " ";
        }
        std::cout << std::endl;
    }
}
```

## 查找顺序和层
为什么要引入一个中间变量如`asr::Display`，asr命名空间下面的类都只有声明，仅起到标识的作用，但是引入它们是非常有必要的，主要有两个原因，一是为了避免相互引用，A->B && B->A，相互引用相互依赖是可能发生的；第二是为了给系统加入层的概念，举例说明：
```
struct AFilter: public Ability<asr::Data, asr::Data>, public asr::Data {
    std::map<std::string, User> userMapExtra;
    void asInit(AData& pData) {
        userMapExtra = pData.userMap;
        userMapExtra["03"] = User{"03", "Hanmei", "f", 16};
    }
    virtual User& GetUser(std::string id) override {
        return userMapExtra[id];
    }
    virtual std::vector<std::string> Keys() override {
        std::vector<std::string> keys;
        for (auto item: userMapExtra) {
            keys.push_back(item.first);
        }
        return keys;
    }
};

class Table: public AbilityContainer<ASelect, ADisplay, AKeys, AFilter, AData, ATitle> {};
```
### 查找顺序
对于每个`Ability`的子类，它们的Ioc顺序是和它们在AbilityContainer中的位置有关的，它会从自己所在位置的后一个开始搜索，一直往后循环一圈（即顺序搜索到最后一个，再跳转到第一个顺序搜索到自己的前一个）。
对于一个`AbilityContainer`出现相同的角色，比如`AFilter`和`AData`它们的角色都是`asr::Data`，那么那一个生效取决于它们的位置，按照搜索顺序，对于`ASelect` `ADisplay` `AKeys` `ATitle`所有查找到的`asr::Data`，实际上都是`AFilter`，如果更换顺序为 `class Table: public AbilityContainer<ASelect, ADisplay, AFilter, AKeys, AData, ATitle> {};` 那么对于`AKeys`她找到的就是`AData`。

### 层
这里说的层非常类似photeshop中的图层，上面的图层会遮盖下面的图层。
- 对于`大类`而言，若出现同名的`角色`，只会暴露出最上面的那一个，这个例子中，`大类`只暴露了`AFilter`，而`AData`被隐藏了
- 层的性质非常适合用虚函数和继承的方式来实现

加入Filter后的完整代码如下
> run it online : [**compiler explorer**](
    https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAM1QDsCBlZAQwBtMQBGAFlICsupVs1qhkAUgBMAISnTSAZ0ztkBPHUqZa6AMKpWAVwC2tEJNJb0AGTy1MAOWMAjTMRABmAGwAGUgAdUBUJ1Wj1DEzN/QOC6GztHIxc3L18lFTU6BgJmYgIw41NzNMxVEKycgjiHZ1cPH0Vs3PyIosbK22rE2pSASkVUA2JkDgBycW8AQSl3W2RDLABqcXcdZAUCYltgZexxqckZ2jmDReWdAgM/dh296dn5zCWVggBPP0wAfQ3mQgUbyb2AHpAQsAI4GVAER57KFGK7MKFPc6YOHCRFnV7vWjMIyYAB0BJ2CzmzAUCgWOlYf3cu0m62IBlUYIh6IA7LJJgsuQtYfD0c83locfiCQsJsRgNTaRNuQsDEFRAtmH4ri8ngARClUs7iyUEvE3dwcqas9XLY28tHQ54ovnWnTrdAgEBBABenwI%2BqJJLJWqle3pjIIzMhnzdmGD4nZe1lloR9sdzvDX31Yol/s53PlWyVKtYauWmsp1J0uoUXpp5tupqrAMmwIWrDw6yWkzj/POguxuNTZf%2BE0DTMxymbkejma56wReGQxLo60wAA8/MQFomXXh3V815vrZrw6gqPqIGWerWTWajbc27arUj18nPaK%2B5W6Rsgzv3QQmy2o8bZVOaizmgtALsuq4Pru27hhqn6YIex6nueUaXsaMK3vGGIYVCZw%2BuWhI0sSwi%2BgAKqQRGkvheJppK/bDj%2BBA6umFbYAs6CoB8pJfIKDEQPRo5nCRTF6gRuw0meV51hM7aYLhxHkkJr4TNmipcfxv7uJqWBzMOEDsZxCjce8vHqYxKyKdgEA9NZyH1iCyqquhqLxkiw7do8ABi5FucKCwkVY/aDsGDn5rZ0nYfaPm4gsXk8l2wq9umgXvkyIUvGcsWmcJVGGqxf4xlmCrAHF7ywVFnnOjJuaOSsZYschNaSVMN7OR25Uxd58XRf5/YqcVaXboWJVCtFaUZeRPU0pVgphUCIK2Fgi4fAA7jkKquE5dpyZRfnkZBW7BgAktoS7JQyTILUuK1re8q75ROcpFcNsGKf%2B3KATOc6gVC4FrgQTobgdCyXYusHHYtDWode4WtbJKx4amJEKHt/1JlBT7UYdGbSTxAkrCD13EOtxCCcjCxYzsLFsRxTgGHgrDoB8C0zpgCh8bj6ykyxKMAwTSjglowxnFjLESWhLVbfD8l%2BQFSl9QstP04zzPDOSQ3aawun6YrDNM9oLNs/5Vk886RjMAA1p8fOYALRxwzo/lo%2B6OxWTZTVzQsK6oHwJSMRLVrbb6HlnR%2BXs%2B6oHzEPo0LjjK3IyYHVE0djsry2lZVdRVIBVWNApYr5ZbOgAStH9Xu414sw5LqzS8HSlBZ7UfhwQRkx29XIJ1LlGJbRSmp096dDe1HmVRF1WhXnI2PIX2eCmXaEV9Dnc1ztdfSg3Ye%2B3ri1LLHsYRRimc9ynhU5oPmnDe5MWj7D4/pbV6bOiD8/VlDUke2bBDIAgfz%2B5hk9XwALKdXztFCY0gGAgKnjLKBV8SJF1gQlUURdWZmXXilYMn9v7UkrsvdqwDL4FwgYg7qVgSGPHgeQ1MKDOZyyelgn%2Bg0L7tQYSWAh4DIEwL8gghYNCMY7Gmu8MKeDM4LAIe1cBVDnzEMId1VgUjqL%2BXIX5MgsiRSKJ4e1Q6vg1GpkOgoikBidD6N0aKUsBi%2BEhyZKwpE4iOZmVLPIMUEDubDQYoJeRMtXFZXMqo%2BB3j7HCx0YdAJxk8Y6B0KEkctCIkhNElA9xKxSyuL4VTe6ccuTy2HLBVhXwzh2LCTEjhUTEkO08f5Ep4T/HxLceEuJBoaQJPCZEgkE0SaNNqTE4x%2BpyLaJ2E0rpEwenOP6bw1BL8ASLz/jhABvkCnQMkaY6iHDlFkSWVw8qiNNGiO0QYkxmyzFGP2UfMxEwLGoKsZghE2DbEDIcYs4pNSfEOwmlYSpMS1nVIadgO5QTenvIcS075vykn1NGc85JNTUmiV3u3R6OZslDVyQ4%2BZpTHnAs6Q4z5bynmBPMkXAFwtCVJOGRZEFsThl9I6RCoZrSRkdOhd8yGwiD6zOivM9yvYZHtRIp4g5iiyFqJUQYyhQrdnrOOaA9Rhj1nGKMWc9Zlj64YIWDY/J5L2EuNxYUrF5ScUYueSRPxBLtXRIceKsF1K8UROJRS01pTIUYsZUSdJ/cEWChydcxhKLyXgutby15tqvl%2Bp1US%2B1zTSXtJ%2BZis43S6VUujTS4ZmqGApPGaJZl7tpn23wQYlZQq1n8o2ScjRyjxVFslVPVMOgjnyvObQ9B50rlfx/rcmNKwU1BsDeGj5E0TUGutRa21QKQ1mtjZaxN1rHWjOdYRV1p9FSIovsi9V7adCjtKdioN/aN11OHaS3dXT6m9O8IewFtK8TkU7VC9NTLy5v2alXAObLHgct8gG9ZSiC2qKLaKrROiK1GNrbKhVRalWNo/GqjtvqrWhvMnqoNxrbVDp7YC4dE7yXToZbel1e8F3FSXZqFd0G11no8d2gdcGHY7tg2OlYGG11AraWR0FlLT20YdRemdOHKz3pZbDQ%2BUqxGrJFYK392yhPlpLeTIDsrK2ctOfWtBAYVVQZ0Ki8JLGXleNQ4JPtyHgn7t06x4zESuPYfWGkvDmSnqEdVV6wyPrGPmcnVRippmmO7W4ehtj/zTNaYCxZjGJ7DQLwfZtZ9nYhNvp7KKL9Raa1ybrYqi5yqm32ZbWrEjzytPuco3R9dHHNNFa6T5jzLnyKzrytZ%2BFi6PVIoc3k7L1rcv6q0yOkrgKGM5c62cdrFWxmWYzXxrNT7/5RegTF6V%2BbxN7Nkwl%2BTSDqLmJSw2lT6XWGrueeiwLrmCvBt6/Roz%2BWHXdanQNqrsKCo2fdaVIe1qquZtwWPM4%2B0PQLD0djECYEVxKgMEQYGJ1FwMBtgYQWmAUEADdXBKAgOua2tshb0ZyoRb7jFJCeDPJMAAtESDWul4dA4%2BPzMHdtXu7gQgSCAWMegLGxwsTgABVOn5MUe7GjKaMWS8XsrDe9uewvV6EW0wODJcIPEcQ8wND4gShbgX3x4KCAINxek%2BGFDmHmA4eoxAGbS228rok/B2cAXlYOfqjdpXCLLlBPQIk1W0Ul4INMgmE4emhACw1fliXdgsEi7njdYqdUmAsToAUDYDSmpnnqgmRkhYkPUB4HQEqBQx1CAQH1LT/KNYHrMH%2B6gZPx14%2BW3TwSTP7IFjEAjIMWgdPODml3maSZ4Xs2uWky7t3ahWb9jwmKV3TZXh6HoD8Owd1PdPXb/35sJFLg%2B6GuuC4Vx7YT%2BCKzGPspl9qAUNPxfCxOJ95Xzg6GfgDBOCbMgEA13e8d5eIP7IHRiBWSuw9APxVwYG09ZbUXwPQfg/VzL%2B2B4R4VOG%2BeArMEkYkcKsorAqAqAfgesaee%2BHeoBZMb%2Bqsrs/u3IKEl%2BIiQmfufc3IueRAUgngxBCwVAC0j%2B86soN2ioqBrMsE64uuVsROhuZOvOFOQBeIJ4%2B%2BneCg4BGB1Bf2RBGOpBDCmASeQ0LArArATMqIZweBlk64NAxAq0xA6AOoPBU%2BM%2BcMlkiBk%2BYBvS%2BsaBFul%2BsoleFwxANeYh6hTUsoWBD0OBtu/YsohBqAxBpBxA5B2glB5eCwDYf%2BSgZBC0ph%2BG5MRh9BDWn%2BQOKuv%2BUuGu5O7olOXBIBYBoWIRXIrh7hGOGW384hsEUhMheAchKwChWuAMyhqhNhpYmhW%2B2hLsehB%2BfQYR%2BAxhXOz%2B3I5h1eORCA4hAhDe2BrKE2V8duCm1EAACjkDiCfBkXnoDkXprhMcQFMVkZ4KmH4JMUYHwU/rHi/s0e/nPtrkwfrktKwUjg6BwYhJoakbxpAQQXnisd0XkZIWwIUcUToKUUoSQJURoUgbUYvvUcwFcXwYYS0azOgbYYIRXlXpYdTB8AURANYeROsUsZsRnn0fYY%2BiuHgJDvGBfg9PHonoDoQB8HQJrmXrINnrHo4VfKBm3rIPgVyASUnrYMSaSSeA8cwOROAisamICVsVQdQfLAxF8PnvdkJuuNpMwC8E1qWAIiAEHiHmHnjLcTQcVAxLBGpNaiAX8dcDcekbVmqaOCtIQAgMcRERfDrMrOESWIkhAfqUKaOJIFHLPhfANA4pvBHM6fbOCKGDbraaMv6RCYIfLNYUUcqJ6pljKfqQBNrpKdKfcv0tGdyAxKQEmVyMKUQKme0YIQxE6dHFmTsZCcKctCaWacjGmaRo0hWT1j8tWS1rxnadmQaYDqCVlpqG6WcB6S3CDGcD6VCMTruA4oTotMTj/mwWJNGqGWbH4GkU2fpCyQQBAJybvoCUgazORCrGCSYU2QuSSXYEuU4FRG0bHhifvAJi%2Bn5NoSbIDB6Hos4XcQDtAbAfAYudvtcCIdkQQNeQjqrvbBOuSfqZ0TCbuWyeuMABGMLC7J8SoTkFUW%2BToXxNZGiUGf0VJGedXLmgWleX9ADI%2BHeQyUIfnvObQGnoAg8UYBNHUR%2BZ4DyN%2BSwWOWcf%2BdsZCVCRYVYXiKSKnouWBRBfRlBdrhUbBYJHUTSIhT0MhXChiQMeeUMXMgYoscsQRa4bCfCWRdRaquRApZsTyaKMiVMQBU2UBexZxbQPMRAHpaiaXuiZSdJRhaIiMe%2BthXzhjOTPeTMcISQdkQUbIVcBAPBQ8V%2BThU/PRRLmGt8gZYWVyEZcSC8T5awPIfxQDOBeaolc6IJWocJf8aJQQEhVZShaefHDzrJdFA5dFB5HgDLoFUWlYJgFQMpjnvcepd5UUb5eVZVQ8eQZVeRDVXVTpdROwHVRFSxXgFQF9D9quGUU/IZAoMKDblfBKSUFKRlBVQ2oIhwCAN7pgJVnKTiYYJgENSxR0dCTXp1bQiqahZFQsMoIEQKSxdFc1W8aUQNRjMeSxQVVyO9TyEVe1KVY8FYKSPVbHpkU1bFS1awBAP9ZzOpcRDlcxZCdFTDdZY3heLNAcPcCcPaOoPSJgDiP2HcEcA8PeBsFsHjWjQTRjUiNOaTYcMcKcCsNDqoCQNTejXTToOoGbCRTOUpOth%2BIzkoKPnCg%2BMTYqInn0ULZsIqO5GLdrvSDmEoIuH0bYMFOBU9tDHsO5AoOscMMngLZfg3CRIQLqYLSquqM2PCPfMbeliDukNLeluqAiMwHDYIZDhVRcGwAsHzRtNkQAOIRie0P7i1bCZ4XzsbnUu25AGDu3rgM1EDtIOgy3C3bCEQADSmALwbMwdmoodl%2BWBKFDcqd6dzKUkDcEwBt34cMxoJdptmtwgFtPNzu1tvs54VdDtzdKqEwBdh%2Bb46WEw5VmsG0o2JdZd7AIAnsJ%2BZ%2BV%2B/e98OgpIbgIAw9OhTtQVIAMdTNvOCdEtSdrEJlZlB1gh0V0dvsa98duFiduGsgkgkgh06hl95EUgkg9gs1t9Swl9IOCtz999EwKtl9udklNlUyj6Ld2Qo9x%2Bp%2Bn0G%2B09s9zo9t2QoyoDE9UD8pDtS9jByor2G9Ww5E/tRI8orggCaDKFEwMDzAPh51uDxA%2BDM5AArBfZIN4HXj/VQ5qENNg9GJffQ/fXfZfSRKgEYJwy/ZIHw8/ZwAABy/32n82UPiA0P33eCSD33SPMMXysO0NyP8P31WCMjpQf2X1UD8OcCsjiMPSfXh1u2sAe382kG%2B0ED%2B2TUuiJ3AzoC06oDS6bCnA1ZmHHWPR4NoM0Oi1MNI2X6mOR3mOH2M1x2B2iBEid2P4uOuBuNtz6lhOx3oOn2b1EiWyF0oWyjKELBLmzGEAoij3kOUN72HWZPljH4KCmlODMDIDmxK6wh4inU5V9F2GUl3VeMVOBNN5hQl2N2qAgPj3gM8GQMKBz0DOBWIPEPn162HEEMn1JiJ3kROAwHxWETFCqC9EoXTMO0ABUnsMzKFTJBeJFi5uzsD2RxD5JhzyDQ0xBRz0gF1soqz%2BgpzZlkTxUieZTsoI1eTYAYAmzUI6AeIaABg9ASuTjPzkJQLvRfj6hTDZUDIFdFZ0V74KLTZn1AEygvs4heIrgpImu3zbTR1bFZBbAsu%2BV/9zeA47d1d5tQzYDs4EDZw0zZttd5EFzzAszOe4z0D%2BztzsDxzCeSeJlaeXLpB1zsKgrjt9zGOjzzz702uq9ETGDUThEO9qAxenzjj0LXI2D2R5DsEfgxDuONI1jtjxL2TSrAMKrqTSz6ThEiS51DEeIVTNTdTDT5DeIVrLro4br8oHr9TEA3r7kr1RZ/r7rHwtTwb3r8t4bOZkbgb0bnrdjRAxOidIb/NHF4F25l1CNypOd1LfT7dndjLE9LLKwiDndnLfLSDQr1WcKXLBzJrrdwrhJYr5zdbMzVzDtNzrb2QsEDzbbTzn1yTx9nzRImrxeery9dr69aTJNhEFTxrprOwMTCb1B0V3TVLyNRjgD7dfdUIbgY9TLk97urL3bDttbc9Rz0a8Dn0XLKD8zXNiz9jm9WDljhEJTyo2Ai43wfRJznbJ4PbNFA7zAs7P7fgf73wq7DteIUHJLNmPj0H/7Sx0jqj7gCjiLLDljbDdDWHOjkgAAEiILiHgOo7o/oyQQA%2B08jbKME%2B7QazRRa/zXY7LSLU4wsHE8QAk0vZ42S1BzB%2Bh/C4oz07Hox6E8q0faq4u%2Bq6xBu9x644nok02eO7Jw60u6xDu%2Bdbk/kwDoU0YMU5I7%2B2hxB/x5CRUwG9Uym8G4Z80yta09ax9R0/DV02nV3SecW6Nj3iRICSPaexW6M7fsPgPaWJM1yfSxy2KDW2KEe64JF9e2KAvTyxMA%2B%2BfnM7azJ/a%2B%2B1pzyIbVuYdZCX%2BKxV0bYPMZe3PSl6JWLIq5ONJ%2BEzlxx1vQsBU4/kV8V%2BXtFeV1q/bNWx5y7LV2Ow1ykwu5p/J2xOy1Kexw4989K916Zb15V9A1N/fJZL63VwrGsx10V0CzN5vbqy508wtxV1W3W5My7Bt1JQA3sErfZrYKQ5fn56fo8NkC930Xp8pegA7aPW9%2BwD64t5bMt/PQV4N7O%2BuGC5GCsGcMvUoAQMtBACI8HYVjoGxHc9DysAIwI%2BJzGQDJD0iDD%2BuJYOs5XDkyQHk8pZk79/5/iD10D2d3PZ3WDxZ1yJ97Md98AzyDTwD6dzPd26ty7Jk9ZCz9QRDwMFDyj7DxGAj0jwT5jxz7Kxj6j/fdj855t7j86Pj31pj0T9oCT0W3u6aCMH0KwCACMFQyMKQKYCMN4Jb6gGb%2BujIHIGuAMEMNCAcJwJbwQGb7b9ZKQObCANwN4HiHI5wN4CIwAJzuAiOSCcCeDR%2BcBUNCBm/cCW/W%2B2%2BkD28jCW8KAgC%2BDe82/G%2BkBwCwBIBoBwj0wJcUAQDl9%2BCV9uDABh/mDkH90y6UBOA%2B%2BW%2Bu7YjEAvBm%2Be%2BkDl%2B4j0AADytA%2BYnfpAWAHNwAI9hfU/FVvs2JrMk/S4JQ/2owGfStygk/TYTgSxvfegWA/fXvmwRnIwnvfQNA9ATAbAHAPA/AggwgogKAcgcgQgeAh58AfQsBGQoEZv2ObHI6ELASAneMgAxjnxxalANAEASwM0FMCcALA2gKoAkCSCCAAgQQP/vAPQHRA/%2BKAmoG4EQFAsygbQbAUQKgF/9yguQfAV0EIENAKgZA%2BgdQI6CoDagnAPoAoFd7DAuAJvM3hbyt6T8s%2Bi4ERp4GxyeBuACwYAMgFnBh88QkgPJrgEIDk9pgiAikLwzr7sA7oHvWnI7wvrSAvenfP3j0WYBYA3AxsAPpIAj5yD4%2B3gbwO4HcDcBWQIjRPt4FZDmBTeIwVPgIPn5Z8c%2BefUgAX197F8YAiAEAOL2Pxflq%2BtfevoIHEJKC6B1/RgFIXv68BloSxPwIYOT7m80%2Bggs3ioIWAlkCACABYMINEHiDJB0ghnMH0kAGDC%2BfvAPu4GD6shE%2BEfVwZIFZC2DY%2BnAdoVkK8Hp87eZvPwfn0MG8CRgNQ7wRn18EBCRhpAaXEEA0DcAgAA%3D
) 
```
#include <iostream>
#include <string>
#include <map>
#include <vector>
#include <iomanip>

struct User {
    std::string id;
    std::string name;
    std::string sex;
    int age;
};

namespace asr {
    struct Title;
    struct Display;
    struct Select;
    struct Data {
        virtual User& GetUser(std::string) = 0;
        virtual std::vector<std::string> Keys() = 0;
    };
    struct Keys;
}

struct ATitle;
struct ADisplay;
struct ASelect;
struct AData;
struct AKeys;
struct AFilter;

struct ATitle: public Ability<asr::Title> {
    std::vector<std::string> asInvoke() {
        return std::vector<std::string> {"Id", "Name", "Sex", "Age"};
    }
};

struct AData: public Ability<asr::Data>, public asr::Data {
    std::map<std::string, User> userMap;
    AData() {
        userMap["01"] = User{"01", "Tom", "m", 18};
        userMap["02"] = User{"02", "Lucy", "f", 17};
    }
    virtual User& GetUser(std::string id) override {
        return userMap[id];
    }
    virtual std::vector<std::string> Keys() override {
        std::vector<std::string> keys;
        for (auto item: userMap) {
            keys.push_back(item.first);
        }
        return keys;
    }
};

struct ASelect: public Ability<asr::Select, asr::Data> {
    std::map<std::string, bool> selected;
    asr::Data* pData;
    void asInit(asr::Data& Data) { pData = &Data; }
    bool asInvoke(std::string id) {
        if (!selected.count(id)) {
            selected[id] = true;
            return true;
        }
        selected.erase(id);
        return false;
    }
};

struct ADisplay: public Ability<asr::Display, asr::Data> {
    asr::Data* pData;
    void asInit(asr::Data& Data) { pData = &Data; }
    std::vector<std::string> asInvoke(std::string id) {
        User& user = pData->GetUser(id);
        std::vector<std::string> list;
        list.push_back(user.id);
        list.push_back(user.name);
        list.push_back(user.sex);
        list.push_back(std::to_string(user.age));
        return list;
    }
};

struct AKeys: public Ability<asr::Keys, asr::Data> {
    asr::Data* pData;
    void asInit(asr::Data& Data) { pData = &Data; }
    std::vector<std::string> asInvoke() {
        std::vector<std::string> keys = pData->Keys();
        return keys;
    }
};

struct AFilter: public Ability<asr::Data, asr::Data>, public asr::Data {
    std::map<std::string, User> userMapExtra;
    void asInit(AData& pData) {
        userMapExtra = pData.userMap;
        userMapExtra["03"] = User{"03", "Hanmei", "f", 16};
    }
    virtual User& GetUser(std::string id) override {
        return userMapExtra[id];
    }
    virtual std::vector<std::string> Keys() override {
        std::vector<std::string> keys;
        for (auto item: userMapExtra) {
            keys.push_back(item.first);
        }
        return keys;
    }
};

class Table: public AbilityContainer<ASelect, ADisplay, AKeys, AFilter, AData, ATitle> {
public:
    std::vector<std::string> titles()                { return invoke<asr::Title>(); }
    std::vector<std::string> keys()                  { return invoke<asr::Keys>(); }
    std::vector<std::string> display(std::string id) { return invoke<asr::Display>(id); }
    bool                     select(std::string id)  { return invoke<asr::Select>(id); }
};

int main() {
    Table table;
    for (auto data: table.invoke<asr::Title>()) {
        std::cout << std::setw(8) << data << " ";
    }
    std::cout << std::endl;

    for (auto key: table.keys()) {
        for (auto data: table.invoke<asr::Display>(key)) {
            std::cout << std::setw(8) << data << " ";
        }
        std::cout << std::endl;
    }
}
```

输出：
```
Id     Name      Sex      Age 
01      Tom        m       18 
02     Lucy        f       17 
03   Hanmei        f       16 
```

## Compiler compatibility
- Clang >= 5.0.0
- GCC >= 7.1
- MSVC >= 19.20